### 数据链路层-点对点协议 PPP

因特网用户都要链接到某个ISP才能接入到因特网，PPP协议就是用户计算机和ISP进行通信时所使用的
数据链路层协议

#### PPP协议的组成

##### PPP协议有三个组成部分:

* 一个将IP数据报封装到串行链路的方法;PPP即支持异步链路，也支持面向比特的同步链路；IP数据报
    在PPP帧中就是其信息部分，这个信息部分的长度受最大传送单元MTU的限制
* 一个用来建立，配置和测试数据链路连接的`链路控制协议LCP(Link Control Protocol)`
* 一套网络控制协议NCP(Network Control Protocol)

##### PPP协议的帧格式

###### 字段的意义

PPP的帧格式如下图所示，PPP帧的首部和尾部分别为四个字段和两个字段
首部的第一个字段和尾部的第二个字段都是标志字段F(Flag), 规定为0x7E; 标志字段表示一个帧的
开始或结束；因此标志字段就是PPP帧的定界符，连续两帧之间只需要用一个标志字段；如果连续出现两个
标志字段，就表示这是一个空帧，应当丢弃

首部中的地址字段A规定为0xFF, 控制字段C规定为0x03,最初层考虑以后在对这两个字段的值进行其他
定义；所以这两个字段实际上并没有携带PPP帧的信息

![link_04](https://github.com/yangguangyong/yangguangyong-s-blog/blob/master/assets/2016/04/link_04.png)

PPP首部的第四个字段是2字节的协议字段；当协议字段为0x0021时，PPP帧的信息字段就是IP数据报；
若为0xC021，则信息字段是PPP链路控制协议LCP的数据；而0x8021表示这是网络层的控制数据

信息字段的长度是可变的，不超过1500字节；尾部中的第一个字段（2字节）是使用CRC的帧检验序列FCS

###### 字节填充

当信息字段中出现和标志字段一样的比特(0x7E)组合时，就必须采取一些措施是这种形式上和标志
字段一样的比特组合不出现在信息字段中

当PPP使用异步传输时，它把转义符定义为0x7D, 并使用字节填充，填充方法如下：

* 把信息字段中出现的每一个0x7E字节转变为2字节序列(0x7D, 0x5E)
* 若信息字段中出现一个0x7D的字节(即出现了和转义字符一样的比特组合),则把0x7D转变成为2字节
    序列(0x7D,0x5D)
* 若信息字段中出现ASCII码的控制字符(即数值西哦啊于0x20的字符),则在该字符前面要加入一个0x7D
    字节, 同时将该字符的编码加以改变，例如，出现0x03就要把它转变为2字节序列(0x7D, 0x31)

###### 零比特填充

PPP协议用在SONET/SDH链路时，是使用同步传输而不是异步传输，在这种情况下，PPP协议采用零比特
填充方法来实现透明传输

零比特填充的具体做法是: 在发送端，先扫描整个信息字段，只要发现有5个连续1，则立即填入一个
0；因此经过这种零比特填充后的数据，就可以保证在信息字段中不会出现6个连续1；接收端在收到
一个帧时，先找到标志字段F以确定一个帧的边界，接着再用硬件对其中的比特流进行扫描；每当发现
5个连续1时，就把这5个连续1后的一个0删除，以还原成原来的信息比特流，这样就保证了透明传输

为什么要自啊5个连续1后面，不是6个，7个或者8个连续1后面？

因为PPP帧的标志字段值为0x7E，对应的二进制就是01111110, 也就是连续6个1加一个0，所以我们要
在连续5个1后面填充0，来拒绝出现1111110这种情况，那么接收端就不会出现对帧边界的误判了
