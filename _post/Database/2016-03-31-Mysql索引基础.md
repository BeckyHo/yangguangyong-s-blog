### Mysql索引基础

#### B-Tree索引

我们在谈论索引的时候，如果没有特别指明类型，那默认说的是B-Tree索引，它
使用B-Tree数据结构来存储数据，对B-Tree不了解的，[点击这里](htt://www.google.com)

#### 索引查询类型介绍

比如有索引 key (last_name, first_name, dob)

B-Tree索引适用于全键值，键值范围或键前缀查找

##### 全值匹配

全值匹配指的是和索引中的所有列进行匹配，例如前面提到的索引可以用于查找
姓名为Cuba Allen, 出生于1960-01-01的人

就是last_name = 'Allen' AND first_name = 'Cuba' AND dob = '1960-01-01'

##### 匹配最左前缀

示例索引可用于查找所有姓为Allen的人,即只使用索引的第一列

就是last_name = 'Allen'

##### 匹配列前缀

也可以只匹配某一列的值的开头部分，例如前面提到的索引可用于查找所有以
J开头的姓的人，这里也只是用了索引的第一列

就是last_name = 'J%'

##### 匹配范围值

例如前面提到的索引可用于查找姓在Allen和Barrymore之间的人，这里也只使用
了索引的第一列

##### 精确匹配某一列并范围匹配另外一列

前面提到的索引也可用于查找所有姓为Allen，并且名字是字母K开头的人；即
第一列last_name全匹配，第二列first_name范围匹配

##### 只访问索引的查询

B-Tree可以支持“只访问索引的查询”， 即查询只需要访问索引，而无须访问
数据行，就是后面讨论的“覆盖索引”

具体的SELECT是否用到了索引，使用EXPLAIN关键字就知道啦，EXPLAIN的使用
[点击这里](http://www.google.com)

#### B-Tree索引的一些限制

* 如果不是按照索引的最左列开始查找，则无法使用索引
* 不能跳过索引中的列；也就是说，前面所述的索引无法用于查找姓为Smith并且
    在某个特定日期出生的人
* 如果查询中有某个列的范围查询，则其右边所有列都无法使用索引优化查找；
    例如有查询WHERE last_name = 'Smith' AND first_name LIKE 'J%' AND
    dob = '1976-12-23'; 这个查询只能使用索引的前两列，因为这里LIKE是一个
范围条件；如果范围查询列值的数量有限，可以通过使用多个等于条件来代替范围
条件


#### 哈希索引

哈希索引基于哈希表实现，只有精确匹配索引所有列的查询才有效；对于每一行
数据，存储引擎都会对所有的索引列计算一个哈希码（hash code）,哈希码是
一个较小的值，并且不同键值的行计算出来的哈希码也不一样；哈希索引将所有
的哈希码存储在索引中，同时在哈希表中保存指向每个数据行的指针

***注意：目前只有Memory引擎显示支持哈希索引***


##### 哈希索引查找过程

比如有如下查询

    mysql> SELECT lname FROM testhash WHERE fname='Peter';

Mysql先计算'Peter'的哈希值，并使用该值寻找对应的记录指针；因为f('Peter')=8784（假设的）
所以Mysql在索引中查找8784，可以找到指向第3行的指针，最后一步是比较第
三行的值是否为'Peter',以确保就是要查找的行

##### 哈希索引的限制

* 哈希索引只包含哈希值和行指针，而不存储字段值，所以不能使用索引中的值
    来避免读取行
* 哈希索引数据并不是按照索引值顺序存储的，所以也就无法用于排序
* 哈希索引也不支持部分索引列匹配查找，因为哈希索引始终是使用索引列的
    全部内容来计算哈希值的
* 哈希索引只支持等值比较查询，包括=，IN(), <=>


#### 空间数据索引(R-Tree)

MyISAM表支持空间索引，可以用作地理数据存储；这类索引无须前缀查询，空间
索引会从所有维度来索引数据。查询时，可以有效地使用任意维度来组合查询；
必须使用Mysql的GIS相关函数如MBRCONTAINS()等来维护数据，目前开源关系数据
库系统中对GIS的解决方案做得比较好的是PostgreSQL的PostGIS

#### 全文索引

全文索引是一种特殊类型那个的索引，它查找的是文本中的关键词，而不是直接
比较索引中的值。全文搜索和其他几类索引的匹配方式完全不同，它有许多需要
注意的细节，如停用词，词干和复数，布尔搜索等。全文索引更类似于搜索引擎做
的事情，而不是简单的WHERE条件匹配


#### 评价一个索引是否合适的标准：三星系统

索引将相关的记录放到一起则获得一星

如果索引中的数据顺序和查找中的排列顺序一致则获得二星

如果索引中的列包含了查询中需要的全部列则获得三星
