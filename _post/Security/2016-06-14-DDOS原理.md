### DDOS攻击原理

参考文章连接![点击这里](http://blog.chinaunix.net/uid-25603759-id-228187.html)

在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接

第一次握手：建立连接时，客户端发送SYN包到服务器，并进入SYN_SEND状态，等待服务器确认

第二次握手：服务器收到SYN包后，必须发出确认SYN+ACK包，此时服务器进入SYN_RECV状态

第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手

完成三次握手，客户端与服务器开始传送数据，在上述过程中，还有一些重要的概念

##### 重要概念

1. 未连接队列: 在三次握手协议中，服务器维护一个未连接队列，该队列为每个客户端的SYN包
开设一个条目，该条目表明服务器已收到SYN包，并向客户发出确认，正在等待客户的确认包。这
些条目所标识的连接在服务器处于SYN_RECV状态，当服务器收到客户的确认包时，删除该条目，
服务器进入 ESTABLISHED状态

2. Backlog参数: 表示未连接队列的最大容纳数目

3. 半连接存活时间: 是指半连接队列的条目存活的最长时间，也即服务从收到SYN包到确认这个
报文无效的最长时间，该时间值是所有重传请求包的最长等待时间总和。有时我们也称半连接存
活时间为Timeout时间、SYN_RECV存活时间

SYN-ACK 重传次数 服务器发送完SYN－ACK包，如果未收到客户确认包，服务器进行首次重传，等
待一段时间仍未收到客户确认包，进行第二次重传，如果重传次数超过系统规定的最大重传次数，
系统将该连接信息从半连接队列中删除。注意，每次重传等待的时间不一定相同

DDOS全名是Distribution Denial of service (分布式拒绝服务攻击),很多DOS攻击源一起攻击
某台服务器就组成了DDOS攻击。DoS的攻击方式有很多种，最基本的DoS攻击就是利用合理的服务
请求来占用过多的服务资源，从而使服务器无法处理合法用户的指令

SYN-Flood是目前最流行的DDoS攻击手段，早先的DoS的手段在向分布式这一阶段发展的时候也经
历了浪里淘沙的过程

假设一个用户向服务器发送了SYN报文后突然死机或掉线，那么服务器在发出SYN+ACK应答报文后
是无法收到客户端的ACK报文的（第三次握 手无法完成），这种情况下服务器端一般会重试
（再次发送SYN+ACK给客户端）并等待一段时间后丢弃这个未完成的连接，这段时间的长度我们
称为SYN Timeout，一般来说这个时间是分钟的数量级（大约为30秒-2分钟）；一个用户出现异
常导致服务器的一个线程等待1分钟并不是什么很大的问题，但如 果有一个恶意的攻击者大量模
拟这种情况，服务器端将为了维护一个非常大的半连接列表而消耗非常多的资源----数以万计的
半连接，即使是简单的保存并遍历也会消耗非常多的CPU时间和内存，何况还要不断对这个列表
中的IP进行SYN+ACK的重试。实际上如果服 务器的TCP/IP栈不够强大，最后的结果往往是堆栈溢
出崩溃---即使服务器端的系统足够强大，服务器端也将忙于处理攻击者伪造的TCP连接请求而无
暇 理睬客户的正常请求（毕竟客户端的正常请求比率非常之小），此时从正常客户的角度看来，
服务器失去响应，这种情况我们称做：服务器端受到了SYN Flood攻击（SYN洪水攻击）
